
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>swpd.me</title>
	<meta name="author" content="swpd">

	
	<meta name="description" content="This week the draft APIs of PostgreSQL package has come out. You may check it out
on my Github, feel free to leave me a
comment. The APIs are &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="swpd.me" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">swpd.me</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:swpd.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/swpdtz" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/swpd" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:swpd.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/08/12/gsoc-status-week-8/">
		
			GSoC Status: Week 8</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/blog/fat_elephant.jpg">
This week the draft APIs of PostgreSQL package has come out. You may check it out
on my <a href="https://github.com/swpd/duda_postgresql">Github</a>, feel free to leave me a
comment.</p>

<p>The APIs are modeled after the previous <a href="https://github.com/swpd/duda_mariadb">MariaDB</a>
package. By doing so we can hide the differences between MariaDB and PostgreSQL
from our users and let the packages deal with the details.</p>

<p>The asynchronous APIs of PostgreSQL provide a more flexible way to issue non-blocking
connection and query, for example you can use a string array to specify the connection
options you are interested and leave others as default. Currently I am working on
integraing the APIs with the event handling module of Duda.</p>

<p>Next week I will mainly focus on the asynchronous handling implementation of the
PostgreSQL package.</p>


		
		<a href="/blog/2013/08/12/gsoc-status-week-8/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-08-12T08:59:00+08:00" pubdate data-updated="true">Aug 12<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>GSoC</a>, <a class='category' href='/blog/categories/monkey/'>Monkey</a>, <a class='category' href='/blog/categories/weekly-status/'>Weekly Status</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/08/03/gsoc-status-week-7/">
		
			GSoC Status: Week 7</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/blog/monkey_and_elephant.jpg">
This week my effort was mainly focused on developing a web service to demonstrate
usage of the MariaDB package and completing the documentation. You may check it
out <a href="https://github.com/swpd/duda_mariadb_demo">here</a>.</p>

<p>I was also getting myself familiar with the C library APIs of PostgreSQL, the
community comes with comprehensive and clear documentation. For the next couple
days, the documentation website will undoubtedly be my most visited. What&rsquo;s more,
the library comes with native non-blocking support. It rocks, elephant!</p>

<p>This morning I also got an email from Google that announced my successfully pass
of the midterm evaluation. It is an amazing moment and I would like to share with
those that ever helped and guided me.</p>

<p>For the next week, I will get my hands dirty in the Duda PostgreSQL package by
designing the basic data structures and function prototypes.</p>


		
		<a href="/blog/2013/08/03/gsoc-status-week-7/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-08-03T20:32:00+08:00" pubdate data-updated="true">Aug 3<span>rd</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>GSoC</a>, <a class='category' href='/blog/categories/monkey/'>Monkey</a>, <a class='category' href='/blog/categories/weekly-status/'>Weekly Status</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/07/28/gsoc-status-week-6/">
		
			GSoC Status: Week 6</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/blog/seal_wins.jpg">
This week the Duda MariaDB package was completed. I spent some time on reimplementing
the connection pooling due to my misunderstanding of it. The new version maintain
a pool of connections that are either connected or connecting. And a pool is
associated with a web service instead of a thread. The pool shall be defined as
global in the web service, but due to the lack of isolate namespace there can&rsquo;t
be same pool names in differenct web services.</p>

<p>The documentation of MariaDB package was also updated to explain the usage of it.
And for those who want to install this package, please refer to the <a href="https://github.com/swpd/monkey">Monkey fork</a>
of my Github. Clone that repo and checkout to mariadb branch, environment needed
to build this package is set up for you. (Notice: you need <code>cmake</code> and <code>libaio</code>
to make things work, so don&rsquo;t forget to install them.) More information can be
found <a href="https://github.com/swpd/duda_mariadb/blob/master/README.md">here</a>.</p>

<p>Currently I am working on an example to demonstrate the usage of this package. It
will be finished very soon.</p>

<p>For next week I will make some potential improvemnts to MariaDB package, start
to review the asynchronous APIs of PostgreSQL and do some experiments.</p>


		
		<a href="/blog/2013/07/28/gsoc-status-week-6/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-07-28T00:22:00+08:00" pubdate data-updated="true">Jul 28<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>GSoC</a>, <a class='category' href='/blog/categories/monkey/'>Monkey</a>, <a class='category' href='/blog/categories/weekly-status/'>Weekly Status</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/07/21/gsoc-status-week-5/">
		
			GSoC Status: Week 5</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/blog/seal.png">
For the past a few days of this week, I was integrating the source code that required
to build libmysqlclient.a into MariaDB package. Meanwhile I added multiple statements
query support and connection pooling support to MariaDB package. All the features
in my proposal has been implemented and it is happy to announce this package is
coming near to its completion.</p>

<h2>integrate libmysqlclient.a</h2>

<p>It took a bit longer than I expected it would be as MariaDB is such a huge project
(totally 223MiB after extracting). I did spend some time to figure out the relation
of different subparts and picked up those that are really necessary for building
the static library.</p>

<p>The build tools used by MariaDB is <code>cmake</code>, I was not fimiliar with <code>cmake</code> so that
took me some other time to learn some basic usage. I have consulted from
<a href="https://kb.askmonty.org/en/compiling-mariadb-from-source/">blog series</a> of MariaDB
but it did not offer enough information. I turned to more comprehensive
<a href="http://dev.mysql.com/doc/refman/5.7/en/source-installation.html">documentation</a>,
although not all the options are available on MariaDB(such as <code>-DWITH_DEBUG</code>), it
did teach me how to use the same build options used by official MySQL release. (
with option <code>-DCMAKE_CONFIG=mysql_release</code>)</p>

<p>As there are so many build targets, I seeked help on irc #maria and some guy told
me to use <code>make mysqlclient</code> if all I wanted is the client library.</p>

<p>After I got all the missing pieces of the puzzle together, it finally worked out.
I have tested on two other Linux distribution to make sure it was not a pure
accident. :-D (Note: remember to install <code>cmake</code> and <code>libaio</code>)</p>


		
		<a href="/blog/2013/07/21/gsoc-status-week-5/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-07-21T19:50:00+08:00" pubdate data-updated="true">Jul 21<span>st</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>GSoC</a>, <a class='category' href='/blog/categories/monkey/'>Monkey</a>, <a class='category' href='/blog/categories/weekly-status/'>Weekly Status</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/07/14/gsoc-status-week-4/">
		
			GSoC Status: Week 4</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/blog/cool_monkey.png">
This week my time was mostly occupied by completing the MariaDB package. For now,
the basic version of MariaDB package is available, it can happily communicate
with the MariaDB server on my Linux box. I wrote a trivial duda web service to
test some common tasks when dealing with a relational database. During the
implementation and test I did encounter certain bugs, some are very obscure but
thank godness I finally fixed them. The current version is still not the final one,
some APIs may be altered in the future and new features will be introduced into
it. You can retrieve the code <a href="https://github.com/swpd/duda_mariadb">here</a> for
your own interest. :-D</p>

<p>During this week I also discussed some questions I was not sure about with the
guy who implemented the asynchronous APIs for MariaDB(known as knielsen on #maria).
He was nice and answered all my questions in detail. And my mentor, edsiper, who
was busy lately, gave me some advices on how to deal with the duda apis. I wanna
thanks both of them here!</p>

<p>Here are some tasks I will be working on for the next week:</p>

<ul>
<li>write documentation to explain the design and usage of the MariaDB package.</li>
<li>do some code cleanup and fix some potential bugs.</li>
<li>write a more comprehensive example for demonstrating How-To use MariaDB package.</li>
<li>do some survey and try to add connection pool support for the package to reduce
cost of connection setup and release.</li>
<li>add source code of <code>libmariadbclient</code> as a third party dependency because on some
Linux distribution this library may still not come with the asynchronous APIs.</li>
<li>add mutli-statement query support for the package.</li>
</ul>



		
		<a href="/blog/2013/07/14/gsoc-status-week-4/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-07-14T19:40:00+08:00" pubdate data-updated="true">Jul 14<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>GSoC</a>, <a class='category' href='/blog/categories/monkey/'>Monkey</a>, <a class='category' href='/blog/categories/weekly-status/'>Weekly Status</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/07/06/gsoc-status-week-3/">
		
			GSoC Status: Week 3</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/blog/running_monkey.jpg">
This week I spent most of my time implementing the MariaDB package, it is still
incomplete but I&rsquo;ve pushed it to Github, check <a href="https://github.com/swpd/duda_mariadb">it</a>
out if you are interested.</p>

<p>The problem I am currently stuck is for every continue part of the asynchronous
version MariaDB APIs, we need to pass the <code>ready_status</code>(bitmask of all events
occurred on a MariaDB connection socket) in able to issue the call. However,
the socket event callback functions are spilt into five sepreated functions,
and every function only knows the corresponding event it shall handle but no idea
about all the events available on the MariaDB socket. This makes it more tricky
to write the callback functions right, I need to make sure what events actually
occurs on every stage of a MariaDB&rsquo;s connection lifecycle.</p>

<p>Meanwhile, I am also discussing with Eduardo Silva to see what we can do with it.
He did offer me some useful advinces and will show me some examples later. And
as he recommended, we may add connection pool support to our MariaDB package to
avoid connect-on-demand mechanism.</p>

<p>For the next week, I will keep hard working on making the implementation complete
and integrate it with Duda.</p>


		
		<a href="/blog/2013/07/06/gsoc-status-week-3/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-07-06T11:21:00+08:00" pubdate data-updated="true">Jul 6<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>GSoC</a>, <a class='category' href='/blog/categories/monkey/'>Monkey</a>, <a class='category' href='/blog/categories/weekly-status/'>Weekly Status</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/06/30/gsoc-status-week-2/">
		
			GSoC Status: Week 2</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/blog/jump_monkey.jpg">
This week I came out with the API draft for Duda MariaDB package, it has been
pushed to Github but is still under development and may be altered later. For your
interest, you can refer to the repository and leave me some comments:
<a href="https://github.com/swpd/duda_mariadb">Duda MariaDB package</a>.</p>

<p>Roughly speaking, the APIs were influenced by the <code>mariasql</code> Node.js package and
the asynchronous access code of <code>redis</code>. Currently there are three header files,
<code>mariadb.h</code> contains event handling functions declaration for MariaDB connection
sockets and some global definitions; <code>connection.h</code> contains code related to
MariaDB client connections, it is responsible for connection management; <code>query.h</code>
takes care of stuffs related to a MariaDB query, every connection can have several
queries, the queries arer linked as a list and will be executed one by one.</p>

<p><a href="http://swpd.github.io/blog/2013/05/18/monkey-http-daemon-internals/">Monkey Internals</a>
was updated this week (composed part of the scheduler section; the command line
utility section was finished), the remaining sections are still under writing.</p>

<p>This week I also moved to my new apartment, everything got settled down and it
is a nice place :D.</p>

<p>For the next week, I will be implementing the APIs and try to put the package into
working.</p>


		
		<a href="/blog/2013/06/30/gsoc-status-week-2/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-06-30T23:54:00+08:00" pubdate data-updated="true">Jun 30<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>GSoC</a>, <a class='category' href='/blog/categories/monkey/'>Monkey</a>, <a class='category' href='/blog/categories/weekly-status/'>Weekly Status</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/06/24/gsoc-status-week-1/">
		
			GSoC Status: Week 1</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/blog/music_monkey.jpg">
During the first week of GSoC I was investigating the APIs of MariaDB to get myself
familiar with its usages. I had done several experiments with a simple MariaDB
client program which includes connecting database, running queries, fetching results
and preparing SQL statements.</p>

<p>After getting a basic understanding of the MariaDB client library, I moved on to
the asynchronous APIs. There&rsquo;s a <a href="https://kb.askmonty.org/en/using-the-non-blocking-library/">post</a>
explaining how to use non-blocking interfaces with a trivial example. The non-blocking
APIs are modelled after the normal blocking ones, for example the non-blocking
version of <code>mysql_real_query</code> is a couple of functions named <code>mysql_real_query_start</code>
and <code>mysql_real_query_cont</code>.</p>

<p>Besides the official introduction of non-blocking APIs, there&rsquo;s a Node.js package
<code>mariasql</code> that makes use of the non-blocking APIs and serves as a complete reference
of writing a MariaDB driver. I am studying the source code of <code>mariasql</code> and the
<code>redis</code> package of Monkey to see how I can integrate it with the Monkey&rsquo;s event
loop.</p>

<p>For the next week I will focus on designing the basic structures and functions for
Monkey MariaDB package. And the unfinished <a href="http://swpd.github.io/blog/2013/05/18/monkey-http-daemon-internals/">blog entry</a>
discussing about Monkey intervals will continue to be updated from next week
(got a lot of stuffs related to graduation recently).</p>


		
		<a href="/blog/2013/06/24/gsoc-status-week-1/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-06-24T11:36:00+08:00" pubdate data-updated="true">Jun 24<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>GSoC</a>, <a class='category' href='/blog/categories/monkey/'>Monkey</a>, <a class='category' href='/blog/categories/weekly-status/'>Weekly Status</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/06/01/gsoc-2013-accepted/">
		
			GSoC 2013 Accepted</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/blog/gsoc2013.jpg" title="Google Summer of Code 2013" alt="Google Summer of Code 2013"></p>

<p>It is such a wonderful moment when I recieved a welcome letter from Carol Smith:
I was accepted by GSoC 2013 under <a href="http://monkey-project.com">Monkey HTTP Daemon</a> project!
Use the code, Luke! This summer is going to be awesome and unforgettable!</p>

<p>During the summer I will be working on Duda I/O packages which will provide
support for relational databases (MariaDB/Postgresql). All the stuffs related to
my project will be posted on this blog to keep the community informed.</p>

<p>At last I want to share some tips that might help to get your proposals accepted:</p>

<ol>
<li>choose those that suit your interest and start as early as possible.</li>
<li>keep in touch with the community (via IRC, mailing list, etc.).</li>
<li>get familiar with the community workflow.</li>
<li>submit some patches to your applying projects.</li>
<li>discuss your ideas and request some feedback.</li>
<li>write a detailed proposal about your ideas.</li>
</ol>



		
		<a href="/blog/2013/06/01/gsoc-2013-accepted/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-06-01T10:03:00+08:00" pubdate data-updated="true">Jun 1<span>st</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>GSoC</a>, <a class='category' href='/blog/categories/monkey/'>Monkey</a>, <a class='category' href='/blog/categories/open-source/'>Open Source</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/05/18/monkey-http-daemon-internals/">
		
			Monkey HTTP Daemon Internals</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/blog/monkey.jpg" title="Go! Monkey!" alt="Go! Monkey!"></p>

<h2>Table of Contents</h2>

<ul>
<li><a href="#intro">Introduction</a></li>
<li><a href="#data">Basic Data Structures</a></li>
<li><a href="#workflow">Brief Workflow</a></li>
<li><a href="#config">Configuration</a></li>
<li><a href="#sched">Scheduler</a></li>
<li><a href="#clock">Clock</a></li>
<li><a href="#hooks">Hooks</a></li>
<li><a href="#http">HTTP Requests and Responses</a></li>
<li><a href="#api">API Exposure</a></li>
<li><a href="#plugins">Plugins</a></li>
<li><a href="#appendix">Appendix</a></li>
</ul>


<h2>Introduction<a id='intro'></a></h2>

<p><a href="http://monkey-project.com">Monkey HTTP Daemon</a> is a web server that aims to get
the most out of the Linux platform. It comes with low resource comsumption and
great scalability which makes it a perfect solution for embedded devices.</p>

<p>Due to the compact size of Monkey&rsquo;s codebase, it is a proper place for revealing
the internals of a event-driven HTTP web server. Spending some time on analysing
the source code of Monkey will surely worth the cost.</p>

<p>This post is about the internals of Monkey&rsquo;s critical components from the
perspective of source code, you may consider it as a supplement of <a href="http://edsiper.linuxchile.cl/blog/2013/02/27/architecture-of-a-linux-based-web-server/">this
post</a>
(written by the author of Monkey). You are supposed to read it first to get a
general view of Monkey.</p>

<p><strong>Notice</strong>: This post is based on Monkey 1.2.0, you may want to get the latest code.
(check out <a href="http://monkey-project.com">home page</a> for more information). If you
are using an older version, there might be something different, e.g. red-black
tree is introduced since version 1.2.0.</p>


		
		<a href="/blog/2013/05/18/monkey-http-daemon-internals/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-05-18T09:21:00+08:00" pubdate data-updated="true">May 18<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/http/'>HTTP</a>, <a class='category' href='/blog/categories/monkey/'>Monkey</a>, <a class='category' href='/blog/categories/source-code/'>Source Code</a>, <a class='category' href='/blog/categories/web-server/'>Web Server</a>


</div>
	
</div></article>

<nav id="pagenavi">
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner"><div>
    <a href="http://www.vim.org/">
        <img src="/images/vim_powered.gif" title="Powered by Vim" alt="Powered by Vim">
    </a>
    <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
        <img src="/images/cc.png" title="Creative Commons" alt="Creative Commons">
    </a>
</div>
Copyright &copy; 2013

    swpd

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'swpdtz';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-41181986-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>